<!--
=========================================================
* Argon Dashboard 2 - v2.0.4
=========================================================

* Product Page: https://www.creative-tim.com/product/argon-dashboard
* Copyright 2022 Creative Tim (https://www.creative-tim.com)
* Licensed under MIT (https://www.creative-tim.com/license)
* Coded by Creative Tim

=========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->

{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link
      rel="apple-touch-icon"
      sizes="76x76"
      href="{% static 'assets/img/apple-icon.png' %}"
    />
    <link
      rel="icon"
      type="image/svg"
      href="{% static 'assets/img/tns-logo.svg' %}"
    />
    <title>EUDR - {% block title %}Title{% endblock %}</title>
    <!--     Fonts and icons     -->
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700"
      rel="stylesheet"
    />
    <!-- Nucleo Icons -->
    <link href="{% static 'assets/css/nucleo-icons.css' %}" rel="stylesheet" />
    <link href="{% static 'assets/css/nucleo-svg.css' %}" rel="stylesheet" />
    <link href="{% static 'assets/css/nucleo-svg.css' %}" rel="stylesheet" />

    <!-- CSS Files -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />
    <!-- Font Awesome CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css"
    />
    <!-- Data Table CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.5/css/dataTables.bootstrap5.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
    />
    <link
      id="pagestyle"
      href="{% static 'assets/css/argon-dashboard.css' %}"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"
      integrity="sha512-h9FcoyWjHcOcmEVkxOfTLnmZFWIH0iZhZT1H2TbOq55xssQGEJHEaIm+PgoUaZbRvQTNTluNOEfb1ZRy6D3BOw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>

  <body class="g-sidenav-show bg-gray-100">
    <div class="min-height-300 bg-primary position-absolute w-100"></div>
    <aside
      class="sidenav bg-white navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-4"
      id="sidenav-main"
    >
      <div class="sidenav-header">
        <i
          class="fas fa-times p-3 cursor-pointer text-secondary opacity-5 position-absolute end-0 top-0 d-none d-xl-none"
          aria-hidden="true"
          id="iconSidenav"
        ></i>
        <a class="navbar-brand m-0" href="{% url 'index' %}" target="_blank">
          <img
            src="{% static 'assets/img/tns-logo.svg' %}"
            class="navbar-brand-img h-100"
            alt="main_logo"
          />
          <span class="ms-1 font-weight-bold">EUDR Mgt Portal</span>
        </a>
      </div>
      <hr class="horizontal dark mt-0" />
      <div class="collapse navbar-collapse w-auto" id="sidenav-collapse-main">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a
              class="nav-link {% if active_page == 'index' %}active{% endif %}"
              href="{% url 'index' %}"
            >
              <div
                class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center"
              >
                <i class="ni ni-tv-2 text-primary text-sm opacity-10"></i>
              </div>
              <span class="nav-link-text ms-1">Dashboard</span>
            </a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link {% if active_page == 'validator' %}active{% endif %}"
              href="{% url 'validator' %}"
            >
              <div
                class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center"
              >
                <i class="ni ni-check-bold text-primary text-sm opacity-10"></i>
              </div>
              <span class="nav-link-text ms-1">Validator</span>
            </a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link {% if active_page == 'validated_files' %}active{% endif %}"
              href="{% url 'validated_files' %}"
            >
              <div
                class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center"
              >
                <i class="ni ni-folder-17 text-primary text-sm opacity-10"></i>
              </div>
              <span class="nav-link-text ms-1">Validated Files</span>
            </a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link {% if active_page == 'map' %}active{% endif %}"
              href="{% url 'map' %}"
            >
              <div
                class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center"
              >
                <i class="ni ni-map-big text-primary text-sm opacity-10"></i>
              </div>
              <span class="nav-link-text ms-1">Map</span>
            </a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link {% if active_page == 'users' %}active{% endif %}"
              href="{% url 'users' %}"
            >
              <div
                class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center"
              >
                <i class="ni ni-single-02 text-primary text-sm opacity-10"></i>
              </div>
              <span class="nav-link-text ms-1">Users</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/logout">
              <div
                class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center"
              >
                <i
                  class="ni ni-button-power text-primary text-sm opacity-10"
                ></i>
              </div>
              <span class="nav-link-text ms-1">Logout</span>
            </a>
          </li>
        </ul>
      </div>
    </aside>
    <main class="main-content position-relative border-radius-lg">
      <!-- Navbar -->
      <nav
        class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl"
        id="navbarBlur"
        data-scroll="false"
      >
        <div class="container-fluid py-1 px-3">
          <nav aria-label="breadcrumb">
            <h6 class="font-weight-bolder text-white mb-0">
              {% block additional_title_content %}{% endblock %}
            </h6>
          </nav>
          <div
            class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4"
            id="navbar"
          >
            <div class="ms-md-auto pe-md-3 d-flex align-items-center"></div>
            <ul class="navbar-nav justify-content-end">
              <li class="nav-item d-flex align-items-center">
                <a
                  href="javascript:;"
                  class="nav-link text-white font-weight-bold px-0"
                  id="dropdownLangButton"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  <i class="fa fa-globe me-sm-1"></i>
                  <span class="d-sm-inline d-none">Language</span>
                  <i class="fa fa-caret-down ms-sm-1"></i>
                </a>
                <ul
                  class="dropdown-menu dropdown-lang dropdown-menu-end"
                  aria-labelledby="dropdownLangButton"
                >
                  <li class="mb-2">
                    <a
                      class="dropdown-item border-radius-md"
                      href="javascript:;"
                    >
                      English
                    </a>
                  </li>
                  <li class="mb-2">
                    <a
                      class="dropdown-item border-radius-md"
                      href="javascript:;"
                    >
                      French
                    </a>
                  </li>
                </ul>
              </li>
              <li class="nav-item d-xl-none ps-3 d-flex align-items-center">
                <a
                  href="javascript:;"
                  class="nav-link text-white p-0"
                  id="iconNavbarSidenav"
                >
                  <div class="sidenav-toggler-inner">
                    <i class="sidenav-toggler-line bg-white"></i>
                    <i class="sidenav-toggler-line bg-white"></i>
                    <i class="sidenav-toggler-line bg-white"></i>
                  </div>
                </a>
              </li>
              <li class="nav-item dropdown px-3 d-flex align-items-center">
                <a
                  href="javascript:;"
                  class="nav-link text-white p-0"
                  id="dropdownMenuButton"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  <i class="fa fa-bell cursor-pointer"></i>
                </a>
                <ul
                  class="dropdown-menu dropdown-menu-end px-2 py-3 me-sm-n4"
                  aria-labelledby="dropdownMenuButton"
                >
                  <li class="mb-2">
                    <a
                      class="dropdown-item border-radius-md"
                      href="javascript:;"
                    >
                      <div class="d-flex py-1">
                        <div class="my-auto">
                          <img
                            src="{% static 'assets/img/team-2.jpg' %}"
                            class="avatar avatar-sm me-3"
                          />
                        </div>
                        <div class="d-flex flex-column justify-content-center">
                          <h6 class="text-sm font-weight-normal mb-1">
                            <span class="font-weight-bold">New message</span>
                            from Laur
                          </h6>
                          <p class="text-xs text-secondary mb-0">
                            <i class="fa fa-clock me-1"></i>
                            13 minutes ago
                          </p>
                        </div>
                      </div>
                    </a>
                  </li>
                  <li class="mb-2">
                    <a
                      class="dropdown-item border-radius-md"
                      href="javascript:;"
                    >
                      <div class="d-flex py-1">
                        <div class="my-auto">
                          <img
                            src="{% static 'assets/img/small-logos/logo-spotify.svg' %}"
                            class="avatar avatar-sm bg-gradient-dark me-3"
                          />
                        </div>
                        <div class="d-flex flex-column justify-content-center">
                          <h6 class="text-sm font-weight-normal mb-1">
                            <span class="font-weight-bold">New album</span> by
                            Travis Scott
                          </h6>
                          <p class="text-xs text-secondary mb-0">
                            <i class="fa fa-clock me-1"></i>
                            1 day
                          </p>
                        </div>
                      </div>
                    </a>
                  </li>
                  <li>
                    <a
                      class="dropdown-item border-radius-md"
                      href="javascript:;"
                    >
                      <div class="d-flex py-1">
                        <div
                          class="avatar avatar-sm bg-gradient-secondary me-3 my-auto"
                        >
                          <svg
                            width="12px"
                            height="12px"
                            viewBox="0 0 43 36"
                            version="1.1"
                            xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink"
                          >
                            <title>credit-card</title>
                            <g
                              stroke="none"
                              stroke-width="1"
                              fill="none"
                              fill-rule="evenodd"
                            >
                              <g
                                transform="translate(-2169.000000, -745.000000)"
                                fill="#FFFFFF"
                                fill-rule="nonzero"
                              >
                                <g
                                  transform="translate(1716.000000, 291.000000)"
                                >
                                  <g
                                    transform="translate(453.000000, 454.000000)"
                                  >
                                    <path
                                      class="color-background"
                                      d="M43,10.7482083 L43,3.58333333 C43,1.60354167 41.3964583,0 39.4166667,0 L3.58333333,0 C1.60354167,0 0,1.60354167 0,3.58333333 L0,10.7482083 L43,10.7482083 Z"
                                      opacity="0.593633743"
                                    ></path>
                                    <path
                                      class="color-background"
                                      d="M0,16.125 L0,32.25 C0,34.2297917 1.60354167,35.8333333 3.58333333,35.8333333 L39.4166667,35.8333333 C41.3964583,35.8333333 43,34.2297917 43,32.25 L43,16.125 L0,16.125 Z M19.7083333,26.875 L7.16666667,26.875 L7.16666667,23.2916667 L19.7083333,23.2916667 L19.7083333,26.875 Z M35.8333333,26.875 L28.6666667,26.875 L28.6666667,23.2916667 L35.8333333,23.2916667 L35.8333333,26.875 Z"
                                    ></path>
                                  </g>
                                </g>
                              </g>
                            </g>
                          </svg>
                        </div>
                        <div class="d-flex flex-column justify-content-center">
                          <h6 class="text-sm font-weight-normal mb-1">
                            Payment successfully completed
                          </h6>
                          <p class="text-xs text-secondary mb-0">
                            <i class="fa fa-clock me-1"></i>
                            2 days
                          </p>
                        </div>
                      </div>
                    </a>
                  </li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <!-- End Navbar -->
      <div class="w-100 py-4">
        <div class="w-100">{% block content %}{% endblock %}</div>
        <footer class="footer pt-3">
          <div class="container-fluid">
            <div class="row align-items-center justify-content-lg-between">
              <div class="col-lg-6 mb-lg-0 mb-4 text-muted">
                <div class="copyright text-center text-sm text-lg-start">
                  ©
                  <script>
                    document.write(new Date().getFullYear());
                  </script>
                  , crafted by
                  <a
                    href="https://www.technoserve.org/tns-labs"
                    class="font-weight-bold"
                    target="_blank"
                    >TechnoServe Labs.</a
                  >
                </div>
              </div>
            </div>
          </div>
        </footer>
      </div>
    </main>
    <!--   Core JS Files   -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="{% static 'assets/js/plugins/perfect-scrollbar.min.js' %}"></script>
    <script src="{% static 'assets/js/plugins/smooth-scrollbar.min.js' %}"></script>
    <script src="{% static 'assets/js/plugins/chartjs.min.js' %}"></script>
    <!-- Font Awesome Icons -->
    <script
      src="https://kit.fontawesome.com/42d5adcbca.js"
      crossorigin="anonymous"
    ></script>
    <script>
      var ctx1 = document.getElementById("chart-line").getContext("2d");

      var gradientStroke1 = ctx1.createLinearGradient(0, 230, 0, 50);

      gradientStroke1.addColorStop(1, "rgba(94, 114, 228, 0.2)");
      gradientStroke1.addColorStop(0.2, "rgba(94, 114, 228, 0.0)");
      gradientStroke1.addColorStop(0, "rgba(94, 114, 228, 0)");
      new Chart(ctx1, {
        type: "line",
        data: {
          labels: [
            "Apr",
            "May",
            "Jun",
            "Jul",
            "Aug",
            "Sep",
            "Oct",
            "Nov",
            "Dec",
          ],
          datasets: [
            {
              label: "Mobile apps",
              tension: 0.4,
              borderWidth: 0,
              pointRadius: 0,
              borderColor: "#5e72e4",
              backgroundColor: gradientStroke1,
              borderWidth: 3,
              fill: true,
              data: [50, 40, 300, 220, 500, 250, 400, 230, 500],
              maxBarThickness: 6,
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false,
            },
          },
          interaction: {
            intersect: false,
            mode: "index",
          },
          scales: {
            y: {
              grid: {
                drawBorder: false,
                display: true,
                drawOnChartArea: true,
                drawTicks: false,
                borderDash: [5, 5],
              },
              ticks: {
                display: true,
                padding: 10,
                color: "#fbfbfb",
                font: {
                  size: 11,
                  family: "Open Sans",
                  style: "normal",
                  lineHeight: 2,
                },
              },
            },
            x: {
              grid: {
                drawBorder: false,
                display: false,
                drawOnChartArea: false,
                drawTicks: false,
                borderDash: [5, 5],
              },
              ticks: {
                display: true,
                color: "#ccc",
                padding: 20,
                font: {
                  size: 11,
                  family: "Open Sans",
                  style: "normal",
                  lineHeight: 2,
                },
              },
            },
          },
        },
      });
    </script>
    <script>
      var win = navigator.platform.indexOf("Win") > -1;
      if (win && document.querySelector("#sidenav-scrollbar")) {
        var options = {
          damping: "0.5",
        };
        Scrollbar.init(document.querySelector("#sidenav-scrollbar"), options);
      }
    </script>
    <!-- Github buttons -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!-- Leaflet -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"
      integrity="sha512-BwHfrr4c9kmRkLw6iXFdzcdWV/PGkVgiIyIWLLlTSXzWQzxuSg4DiQUCpauz/EWjgk5TYQqX/kvn9pG1NpYfqg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script src="https://ajax.googleapis.com/ajax/libs/earthengine/0.1.365/earthengine-api.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"
      integrity="sha512-dfX5uYVXzyU8+KHqj8bjo7UkOdg18PaOtpa48djpNbZHwExddghZ+ZmzWT06R5v6NSk3ZUfsH6FNEDepLx9hPQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/toastify-js"
    ></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <!-- Data Table JS -->
    <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.1.0/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.5/js/dataTables.bootstrap5.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/Turf.js/0.0.124/turf.min.js"
      integrity="sha512-jpnZ8xGKbS7L9S6d5fk/zDVgF6OoVKLMoEliLxf24BRX+orWhxqJuUcoM+vGmOaozS9dD9ABjQZKAgjjcwTndA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <!-- Control Center for Soft Dashboard: parallax effects, scripts for the example pages etc -->
    <script src="{% static 'assets/js/argon-dashboard.js' %}"></script>

    <script>
      // Add 'active' class to the current menu item
      let currentLocation = window.location.href;
      let links = document.querySelectorAll(".nav-link");
      const selectedDownloadFormat = document.querySelector("#templateFormat");

      selectedDownloadFormat.addEventListener("change", (e) => {
        const selectedFormat = e.target.value;

        if (selectedFormat !== "") {
          window.location.href = `/api/download-template?format%3D${selectedFormat}`;
        }
      });

      links.forEach((link) => {
        if (link.href === currentLocation) {
          link.classList.add("active");
          document.title = link.innerText;
        }
      });
    </script>

    <script>
      function uploadData() {
        const fileInput = document.getElementById("uploadFile");
        const file = fileInput.files[0];
        const format = file.name.split(".").pop().toLowerCase();
        const file_name = file.name.split(".")[0];

        const reader = new FileReader();
        reader.onload = function (e) {
          let data;
          if (format === "csv") {
            // Parse CSV data
            data = Papa.parse(e.target.result, { header: true }).data;
          } else if (format === "xlsx" || format === "xls") {
            // Parse Excel data
            const workbook = XLSX.read(e.target.result, { type: "binary" });
            const sheetName = workbook.SheetNames[0];
            data = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName], {
              header: 1,
            });
          } else if (format === "json" || format === "geojson") {
            // Parse JSON data
            data = JSON.parse(e.target.result);
          }

          if (data) {
            // Now we have the formatted data
            // Send it to the API
            sendDataToAPI(data, file_name, format);
          } else {
            alert("Invalid file format or file is empty.");
          }
        };

        if (file) {
          reader.readAsText(file);
        } else {
          alert("No file selected.");
        }
      }

      function sendDataToAPI(data, file_name, format) {
        fetch("/api/farm/add/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            data: data,
            file_name: file_name,
            format: format,
          }),
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.json();
          })
          .then((data) => {
            Toastify({
              text: "Data uploaded successfully!!!",
              duration: 3000,
              close: true,
              gravity: "top",
              position: "right",
              backgroundColor: "green",
              onclose: function () {
                setTimeout(function () {
                  window.location.href = "/validated_files";
                }, 0);
              },
            }).showToast();
          })
          .catch((error) => {
            alert("Error uploading data");
          });
      }
    </script>
    <script>
      let dropArea = document.getElementById("drop-area");

      ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
        dropArea.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
      });

      ["dragenter", "dragover"].forEach((eventName) => {
        dropArea.addEventListener(eventName, highlight, false);
      });

      ["dragleave", "drop"].forEach((eventName) => {
        dropArea.addEventListener(eventName, unhighlight, false);
      });

      dropArea.addEventListener("drop", handleDrop, false);

      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }

      function highlight(e) {
        dropArea.classList.add("highlight");
      }

      function unhighlight(e) {
        dropArea.classList.remove("highlight");
      }

      function handleDrop(e) {
        let dt = e.dataTransfer;
        let files = dt.files;
        handleFiles(files);
      }

      function handleFiles(files) {
        [...files].forEach(uploadFile);
      }

      function uploadFile(file) {
        console.log("Uploading", file.name);
      }

      dropArea.addEventListener("click", () => {
        fileElem.click();
      });

      let fileElem = document.getElementById("fileElem");
      fileElem.addEventListener("change", function (e) {
        handleFiles(this.files);
      });
    </script>
    <script>
      const farmsContainer = document.getElementById("farmsBodyContainer");
      let farmData = [];

      const colorClasses = {
        low: "low",
        medium: "medium",
        high: "high",
      };

      fetch("/api/farm/list/")
        .then((response) => {
          if (!response.ok) {
            throw new Error("Network response was not ok");
          }
          return response.json();
        })
        .then((data) => {
          let i = 0;

          farmData = data;

          if (document.querySelector("#total_farms")) {
            document.querySelector("#total_farms").innerText = data.length;
          }

          while (i < data.length) {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                  <td>
                    <p class="text-xs text-center font-weight-bold mb-0">${
                      i + 1
                    }.</p>
                  </td>
                  <td>
                    <div class="d-flex px-2 py-1">
                      <div class="d-flex flex-column justify-content-center">
                        <h6 class="mb-0 text-sm">${data[i].farmer_name}</h6>
                      </div>
                    </div>
                  </td>
                  <td>
                    <p class="text-xs font-weight-bold mb-0">${
                      data[i].farm_size
                    } Hectares</p>
                  </td>
                  <td>
                    <p class="text-xs font-weight-bold mb-0">${
                      data[i].farm_village
                    }</p>
                  </td>
                  <td>
                    <p class="text-xs font-weight-bold mb-0">${
                      data[i].farm_district
                    }</p>
                  </td>
                  <td>
                    ${
                      !data[i].analysis
                        ? '<p class="text-xs font-weight-bold mb-0"> - </p>'
                        : `<i class="bi bi-eye mt-5 text-primary text-lg" data-toggle="modal" data-target="#whispDataModal"
                      id="viewAnalysisBtn" role="button" onclick="viewAnalysis(${data[i].id})" title="View Analysis"></i>`
                    }
                  </td>
                  <td class="align-middle text-center text-sm">
                    <span class="badge badge-sm ${
                      data[i].is_validated
                        ? "bg-gradient-success"
                        : "bg-gradient-faded-dark"
                    }"
                      >${data[i].is_validated ? "Validated" : "Not Yet"}</span
                    >
                  </td>
                  <td>
                    <p class="text-xs font-weight-bold mb-0">${
                      data[i].validated_at
                        ? new Date(data[i].validated_at).toDateString()
                        : "-"
                    }</p>
                  </td>
                  <td class="align-middle text-center">
                    <a
                      href="{% url 'map' %}?farm-id=${data[i].id}"
                      class="text-primary font-weight-bold text-lg"
                      title="View on Map"
                      ><i class="bi bi-cursor"></i></a
                    >
                  </td>
              `;
            farmsContainer.appendChild(tr);
            i++;
          }

          $("#farms").DataTable({
            //disable sorting on last column
            columnDefs: [{ orderable: false, targets: 5 }],
            language: {
              //customize pagination prev and next buttons: use arrows instead of words
              paginate: {
                previous: '<span class="fa fa-chevron-left"></span>',
                next: '<span class="fa fa-chevron-right"></span>',
              },
              //customize number of elements to be displayed
              lengthMenu:
                'Display <select class="form-control input-sm">' +
                '<option value="10">10</option>' +
                '<option value="20">20</option>' +
                '<option value="30">30</option>' +
                '<option value="40">40</option>' +
                '<option value="50">50</option>' +
                '<option value="-1">All</option>' +
                "</select> results",
            },
          });
        })
        .catch((error) => {
          console.error("There was a problem with the fetch operation:", error);
        });

      function viewAnalysis(id) {
        const container = document.getElementById("whispCardsContainer");
        container.innerHTML = "";

        const obj = farmData.find((farm) => farm.id === id);

        Object.keys(obj?.analysis?.data?.[0]).forEach((key) => {
          if (key === "geometry") return; // Skip the geometry field

          const value = obj.analysis.data[0][key];
          const colorClass =
            value < 33
              ? colorClasses.low
              : value < 66
              ? colorClasses.medium
              : colorClasses.high;

          const card = document.createElement("div");
          card.className = "card card-custom whisp-item-card " + colorClass;
          card.innerHTML = `
            <div class="card-body">
                <h5 class="card-title">${
                  key === "gaul0"
                    ? "Country"
                    : key === "gaul1"
                    ? "District"
                    : key === "gaul2"
                    ? "Village"
                    : key
                }</h5>
                <p class="card-text">${value}</p>
            </div>
        `;
          container.appendChild(card);
        });

        const whispDataModal = new bootstrap.Modal(
          document.getElementById("whispAnalysisModal"),
          {
            keyboard: false,
          }
        );

        whispDataModal.show();
      }
    </script>
    <script>
      const filesContainer = document.getElementById("filesContainer");

      fetch("/api/files/list/")
        .then((response) => {
          if (!response.ok) {
            throw new Error("Network response was not ok");
          }
          return response.json();
        })
        .then((data) => {
          let i = 0;

          if (document.querySelector("#total_files_uploaded")) {
            document.querySelector("#total_files_uploaded").innerText =
              data.length;
          }

          while (i < data.length) {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                  <td>
                    <p class="text-xs font-weight-bold px-3 mb-0">${i + 1}.</p>
                  </td>
                  <td>
                    <div class="d-flex px-2 py-1">
                      <div class="d-flex justify-content-center align-items-center gap-2">
                        <span class="fas fa-file-alt text-primary text-xs"></span>
                        <h6 class="mb-0 text-sm">${data[i].file_name}</h6>
                      </div>
                    </div>
                  </td>
                  <td>
                    <p class="text-xs font-weight-bold mb-0">${
                      data[i].uploaded_by
                    }</p>
                  </td>
                  <td>
                    <p class="text-xs font-weight-bold mb-0">${new Date(
                      data[i].updated_at
                    ).toLocaleString()}</p>
                  </td>
                  <td class="align-middle text-center">
                    <a
                      href="{% url 'map' %}?file-id=${data[i].id}"
                      class="text-primary font-weight-bold text-lg"
                      title="View on Map"
                      ><i class="bi bi-cursor"></i></a
                    >
                  </td>
              `;

            filesContainer.appendChild(tr);
            i++;
          }

          $("#files").DataTable({
            language: {
              //customize pagination prev and next buttons: use arrows instead of words
              paginate: {
                previous: '<span class="fa fa-chevron-left"></span>',
                next: '<span class="fa fa-chevron-right"></span>',
              },
              //customize number of elements to be displayed
              lengthMenu:
                'Display <select class="form-control input-sm">' +
                '<option value="10">10</option>' +
                '<option value="20">20</option>' +
                '<option value="30">30</option>' +
                '<option value="40">40</option>' +
                '<option value="50">50</option>' +
                '<option value="-1">All</option>' +
                "</select> results",
            },
          });
        })
        .catch((error) => {
          console.error("There was a problem with the fetch operation:", error);
        });
    </script>
  </body>
</html>
